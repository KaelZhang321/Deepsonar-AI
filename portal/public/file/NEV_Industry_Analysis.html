<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新能源汽车行业深度分析报告 - 交互式大屏</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Tailwind Configuration for Custom Palette -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'warm-bg': '#F5F5F4',      /* Stone 100 */
                        'card-bg': '#FFFFFF',
                        'primary': '#0F766E',      /* Teal 700 */
                        'primary-light': '#14B8A6',/* Teal 500 */
                        'accent': '#F97316',       /* Orange 500 */
                        'text-main': '#1C1917',    /* Stone 900 */
                        'text-sub': '#57534E',     /* Stone 600 */
                        'border-color': '#E7E5E4'  /* Stone 200 */
                    },
                    fontFamily: {
                        sans: ['system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #F5F5F4;
        }
        ::-webkit-scrollbar-thumb {
            background: #D6D3D1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #A8A29E;
        }

        /* Chart Container Utilities */
        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .interactive-card {
            transition: all 0.3s ease;
        }
        .interactive-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Tab Transition */
        .tab-content {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease-in;
        }
        .tab-content.active {
            display: block;
            opacity: 1;
        }
    </style>

    <!-- 
        PLACEHOLDER COMMENTS REQUIRED BY PROMPT 
    -->
    
    <!-- Chosen Palette: Warm Neutrals & Deep Teal. Background: Stone-100 (#F5F5F4), Cards: White, Primary Action/Data: Teal-700 (#0F766E), Highlights: Orange-500 (#F97316). Designed for clarity, professionalism, and reduced eye strain during reading. -->

    <!-- Application Structure Plan: 
         1. Header: Quick navigation and report title.
         2. Executive Dashboard (Hero): "At a Glance" key metrics (KPIs) to immediately ground the user in current market status using counter animations.
         3. Market Dynamics Section: Interactive Chart.js combo chart allowing users to toggle between historical data and future forecasts. Purpose: Show growth trajectory.
         4. Technology Ecosystem: A tabbed interface explaining the "Three Electrics" (Battery, Motor, Control). Purpose: Simplify complex tech concepts into digestible interactive bites.
         5. Competitive Landscape: A Plotly scatter plot comparing Price vs. Range of popular models. Purpose: Allow users to visualize market positioning of key players.
         6. Supply Chain & Challenges: A grid of cards highlighting bottlenecks and opportunities.
         7. Strategic Outlook: Concluding textual synthesis.
         
         Rationale: This structure moves from the "What" (Numbers) to the "Why" (Tech/Strategy) to the "Who" (Competition), creating a logical narrative flow.
    -->

    <!-- Visualization & Content Choices:
         1. Executive Summary -> Goal: Inform -> Method: Animated Big Numbers -> Interaction: Auto-count on load -> Justification: Immediate impact, no chart fatigue early on.
         2. Market Trends -> Goal: Change/Trend -> Method: Chart.js Bar/Line Combo -> Interaction: Toggle Timeframes -> Justification: Best for showing volume + growth rate simultaneously.
         3. Comparison -> Goal: Relationships -> Method: Plotly Scatter Plot -> Interaction: Hover for model details, Zoom/Pan -> Justification: Plotly handles dense data points (Price vs Range) better than Chart.js.
         4. Tech Deep Dive -> Goal: Explain -> Method: HTML/JS Tabs -> Interaction: Click to reveal content -> Justification: Text-heavy technical content needs structure, not charts.
         
         CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

</head>
<body class="bg-warm-bg text-text-main font-sans antialiased selection:bg-primary-light selection:text-white">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-border-color shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl mr-2">⚡</span>
                    <span class="font-bold text-xl tracking-tight text-primary">NEV Insight <span class="text-text-sub font-normal text-sm ml-2">行业深度报告</span></span>
                </div>
                <div class="hidden md:flex space-x-8 items-center">
                    <a href="#dashboard" class="text-text-sub hover:text-primary transition-colors font-medium">概览</a>
                    <a href="#market" class="text-text-sub hover:text-primary transition-colors font-medium">市场趋势</a>
                    <a href="#technology" class="text-text-sub hover:text-primary transition-colors font-medium">核心技术</a>
                    <a href="#competition" class="text-text-sub hover:text-primary transition-colors font-medium">竞争格局</a>
                </div>
                <!-- Mobile menu button placeholder (simple implementation for single file) -->
                <div class="flex items-center md:hidden">
                    <button id="mobile-menu-btn" class="text-text-sub p-2">☰</button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-b border-border-color p-4">
            <a href="#dashboard" class="block py-2 text-text-sub hover:text-primary">概览</a>
            <a href="#market" class="block py-2 text-text-sub hover:text-primary">市场趋势</a>
            <a href="#technology" class="block py-2 text-text-sub hover:text-primary">核心技术</a>
            <a href="#competition" class="block py-2 text-text-sub hover:text-primary">竞争格局</a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-16">

        <!-- SECTION 1: Executive Dashboard (Hero) -->
        <section id="dashboard" class="scroll-mt-20">
            <div class="text-center mb-10">
                <h1 class="text-4xl md:text-5xl font-bold text-text-main mb-4">新能源汽车行业：<span class="text-primary">重塑与爆发</span></h1>
                <p class="text-lg text-text-sub max-w-3xl mx-auto leading-relaxed">
                    本报告深度剖析全球及中国新能源汽车（NEV）产业现状。随着渗透率突破临界点，行业已从政策驱动转向市场驱动。
                    关键数据显示，电动化、智能化已成为不可逆转的时代洪流。
                </p>
            </div>

            <!-- KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Card 1 -->
                <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color interactive-card border-l-4 border-l-primary">
                    <div class="text-sm text-text-sub font-medium uppercase tracking-wider mb-1">2023 全球销量</div>
                    <div class="flex items-baseline">
                        <span class="text-3xl font-bold text-text-main counter" data-target="1465">0</span>
                        <span class="ml-1 text-sm text-text-sub">万辆</span>
                    </div>
                    <div class="mt-2 text-sm text-green-600 font-medium">▲ 35% 同比增长</div>
                </div>

                <!-- Card 2 -->
                <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color interactive-card border-l-4 border-l-accent">
                    <div class="text-sm text-text-sub font-medium uppercase tracking-wider mb-1">中国市场渗透率</div>
                    <div class="flex items-baseline">
                        <span class="text-3xl font-bold text-text-main counter" data-target="36">0</span>
                        <span class="ml-1 text-sm text-text-sub">%</span>
                    </div>
                    <div class="mt-2 text-sm text-text-sub">超越早期预警线</div>
                </div>

                <!-- Card 3 -->
                <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color interactive-card border-l-4 border-l-primary">
                    <div class="text-sm text-text-sub font-medium uppercase tracking-wider mb-1">公共充电桩保有量</div>
                    <div class="flex items-baseline">
                        <span class="text-3xl font-bold text-text-main counter" data-target="272">0</span>
                        <span class="ml-1 text-sm text-text-sub">万台</span>
                    </div>
                    <div class="mt-2 text-sm text-green-600 font-medium">▲ 基础设施加速完善</div>
                </div>

                <!-- Card 4 -->
                <div class="bg-card-bg p-6 rounded-xl shadow-sm border border-border-color interactive-card border-l-4 border-l-accent">
                    <div class="text-sm text-text-sub font-medium uppercase tracking-wider mb-1">动力电池装机量</div>
                    <div class="flex items-baseline">
                        <span class="text-3xl font-bold text-text-main counter" data-target="705">0</span>
                        <span class="ml-1 text-sm text-text-sub">GWh</span>
                    </div>
                    <div class="mt-2 text-sm text-text-sub">全球市场需求强劲</div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: Market Dynamics (Chart.js) -->
        <section id="market" class="scroll-mt-24">
            <div class="flex flex-col md:flex-row justify-between items-end mb-6">
                <div class="max-w-2xl">
                    <h2 class="text-2xl font-bold text-text-main mb-2">市场增长趋势分析</h2>
                    <p class="text-text-sub">
                        通过下方的交互式图表，您可以观察过去五年销量的爆发式增长以及对未来的预测。
                        数据显示，尽管增速由于基数扩大而放缓，但绝对增量依然惊人。
                    </p>
                </div>
                
                <!-- Chart Controls -->
                <div class="flex space-x-2 mt-4 md:mt-0 bg-white p-1 rounded-lg border border-border-color shadow-sm">
                    <button onclick="updateMarketChart('history')" id="btn-history" class="px-4 py-2 text-sm font-medium rounded-md bg-primary text-white shadow-sm transition-all">历史回顾 (2019-2023)</button>
                    <button onclick="updateMarketChart('forecast')" id="btn-forecast" class="px-4 py-2 text-sm font-medium rounded-md text-text-sub hover:bg-gray-100 transition-all">未来预测 (2024-2026)</button>
                </div>
            </div>

            <!-- Chart Container -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-border-color">
                <div class="relative w-full h-[400px] md:h-[450px]"> <!-- Explicit height wrapper -->
                    <div class="chart-container" style="position: relative; height: 100%; width: 100%;">
                        <canvas id="marketChart"></canvas>
                    </div>
                </div>
                <div class="mt-4 flex items-start space-x-2 text-sm text-text-sub bg-gray-50 p-3 rounded-lg">
                    <span class="text-lg">💡</span>
                    <p>
                        <strong>深度洞察：</strong> 2021-2022年是行业"S型曲线"最陡峭的爬坡期。预测显示，2025年中国市场渗透率有望突破50%，提前达成国家规划目标。
                    </p>
                </div>
            </div>
        </section>

        <!-- SECTION 3: Technology Deep Dive (Tabs & Content) -->
        <section id="technology" class="scroll-mt-24">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-text-main mb-2">核心技术："三电"系统详解</h2>
                <p class="text-text-sub max-w-3xl">
                    新能源汽车的竞争力核心在于电池、电机、电控三大系统。点击下方标签，深入了解各技术领域的关键突破与行业标准。
                </p>
            </div>

            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Navigation Tabs (Vertical on desktop) -->
                <div class="flex flex-row lg:flex-col lg:w-1/4 gap-2 overflow-x-auto lg:overflow-visible pb-2 lg:pb-0">
                    <button onclick="switchTechTab('battery')" class="tech-tab active text-left px-5 py-4 rounded-lg bg-white border border-border-color hover:border-primary hover:text-primary transition-all shadow-sm group min-w-[150px]">
                        <div class="font-bold group-hover:text-primary">🔋 动力电池</div>
                        <div class="text-xs text-text-sub mt-1">能量密度的博弈</div>
                    </button>
                    <button onclick="switchTechTab('motor')" class="tech-tab text-left px-5 py-4 rounded-lg bg-white border border-border-color hover:border-primary hover:text-primary transition-all shadow-sm group min-w-[150px]">
                        <div class="font-bold group-hover:text-primary">⚙️ 驱动电机</div>
                        <div class="text-xs text-text-sub mt-1">效率与性能</div>
                    </button>
                    <button onclick="switchTechTab('control')" class="tech-tab text-left px-5 py-4 rounded-lg bg-white border border-border-color hover:border-primary hover:text-primary transition-all shadow-sm group min-w-[150px]">
                        <div class="font-bold group-hover:text-primary">🧠 电控系统</div>
                        <div class="text-xs text-text-sub mt-1">IGBT与SiC</div>
                    </button>
                </div>

                <!-- Tab Content Area -->
                <div class="lg:w-3/4 bg-white rounded-xl shadow-sm border border-border-color p-8 min-h-[400px]">
                    
                    <!-- Battery Content -->
                    <div id="tech-battery" class="tab-content active">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-primary">动力电池：磷酸铁锂 vs 三元锂</h3>
                            <span class="px-3 py-1 bg-green-100 text-green-800 text-xs font-bold rounded-full">成本占比 ~40%</span>
                        </div>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <p class="text-text-main leading-relaxed">
                                    电池技术是决定整车续航和成本的关键。目前市场主要分为两大阵营：
                                </p>
                                <ul class="space-y-3">
                                    <li class="flex items-start">
                                        <span class="text-accent mr-2">●</span>
                                        <div>
                                            <strong class="block text-text-main">磷酸铁锂 (LFP)</strong>
                                            <span class="text-sm text-text-sub">成本低，寿命长，安全性高。但低温性能较差，能量密度较低。比亚迪"刀片电池"是典型代表。</span>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-primary mr-2">●</span>
                                        <div>
                                            <strong class="block text-text-main">三元锂 (NCM)</strong>
                                            <span class="text-sm text-text-sub">能量密度高，低温表现好，适合高端长续航车型。但成本较高，热稳定性略逊。</span>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <div class="bg-warm-bg rounded-lg p-5 flex flex-col justify-center items-center">
                                <div class="text-center mb-4">
                                    <span class="block text-sm text-text-sub">平均电芯成本趋势 (元/Wh)</span>
                                </div>
                                <!-- Simple visual representation using CSS bars -->
                                <div class="w-full space-y-4">
                                    <div class="flex items-center">
                                        <span class="w-12 text-xs text-text-sub">2020</span>
                                        <div class="flex-1 bg-gray-200 h-4 rounded-r-full overflow-hidden">
                                            <div class="bg-primary h-full" style="width: 85%"></div>
                                        </div>
                                        <span class="ml-2 text-xs font-bold">0.85</span>
                                    </div>
                                    <div class="flex items-center">
                                        <span class="w-12 text-xs text-text-sub">2022</span>
                                        <div class="flex-1 bg-gray-200 h-4 rounded-r-full overflow-hidden">
                                            <div class="bg-primary h-full" style="width: 95%"></div>
                                        </div>
                                        <span class="ml-2 text-xs font-bold">0.95</span>
                                    </div>
                                    <div class="flex items-center">
                                        <span class="w-12 text-xs text-text-sub">2024E</span>
                                        <div class="flex-1 bg-gray-200 h-4 rounded-r-full overflow-hidden">
                                            <div class="bg-primary-light h-full" style="width: 50%"></div>
                                        </div>
                                        <span class="ml-2 text-xs font-bold">0.50</span>
                                    </div>
                                </div>
                                <p class="mt-4 text-xs text-text-sub text-center italic">
                                    *2024年原材料价格回落，电池成本大幅下降，推动"电比油低"。
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Motor Content -->
                    <div id="tech-motor" class="tab-content">
                        <h3 class="text-xl font-bold text-primary mb-4">驱动电机：扁线电机成为主流</h3>
                        <p class="text-text-main mb-4 leading-relaxed">
                            电机系统主要由永磁同步电机（占市场90%以上）和交流异步电机组成。技术迭代主要集中在提高效率和散热能力。
                        </p>
                        <div class="bg-warm-bg p-6 rounded-lg border border-border-color">
                            <h4 class="font-bold text-text-main mb-3">关键趋势：扁线绕组技术</h4>
                            <div class="flex flex-col md:flex-row gap-6">
                                <div class="flex-1">
                                    <div class="text-4xl font-bold text-accent mb-1">97%</div>
                                    <div class="text-sm text-text-sub">最高效率</div>
                                    <p class="mt-2 text-sm text-text-main">
                                        相比传统圆线电机，扁线电机槽满率提升20%-30%，同体积下功率输出更强，且散热性能更好。
                                    </p>
                                </div>
                                <div class="flex-1 border-t md:border-t-0 md:border-l border-border-color pt-4 md:pt-0 md:pl-6">
                                    <div class="text-4xl font-bold text-primary mb-1">20k+</div>
                                    <div class="text-sm text-text-sub">RPM 转速</div>
                                    <p class="mt-2 text-sm text-text-main">
                                        高转速化是电机发展的另一方向，能有效提升车辆极速并减小电机体积。
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Control Content -->
                    <div id="tech-control" class="tab-content">
                        <h3 class="text-xl font-bold text-primary mb-4">电控系统：第三代半导体 SiC</h3>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <p class="text-text-main mb-4 leading-relaxed">
                                    电控系统相当于神经中枢，控制电机的转速和扭矩。核心部件是功率半导体模块。
                                </p>
                                <p class="text-text-main leading-relaxed">
                                    <strong class="text-accent">碳化硅 (SiC)</strong> 正在逐步替代传统的硅基 IGBT。SiC 具备耐高压、耐高温、低损耗的特性，是实现 800V 高压快充平台的关键技术。
                                </p>
                            </div>
                            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-inner">
                                <h5 class="text-sm font-bold text-center mb-4">IGBT vs SiC 性能对比</h5>
                                <div class="space-y-3">
                                    <div class="flex justify-between text-sm">
                                        <span>开关损耗</span>
                                        <span class="text-green-600 font-bold">-70% (SiC优)</span>
                                    </div>
                                    <div class="w-full bg-gray-100 h-2 rounded-full">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: 30%"></div>
                                    </div>
                                    
                                    <div class="flex justify-between text-sm mt-2">
                                        <span>工作温度</span>
                                        <span class="text-green-600 font-bold">+50% (SiC优)</span>
                                    </div>
                                    <div class="w-full bg-gray-100 h-2 rounded-full">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: 80%"></div>
                                    </div>

                                    <div class="flex justify-between text-sm mt-2">
                                        <span>系统体积</span>
                                        <span class="text-green-600 font-bold">-40% (SiC优)</span>
                                    </div>
                                    <div class="w-full bg-gray-100 h-2 rounded-full">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: 60%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- SECTION 4: Competitive Landscape (Plotly Scatter) -->
        <section id="competition" class="scroll-mt-24">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-text-main mb-2">竞争格局：价格与续航的博弈</h2>
                <p class="text-text-sub">
                    通过分析当前市场热门车型的<strong>起售价</strong>与<strong>CLTC续航里程</strong>，我们可以看到不同品牌的市场定位。
                    <span class="hidden md:inline">悬停在数据点上查看具体车型信息。支持缩放和拖动。</span>
                </p>
            </div>

            <!-- Plotly Container -->
            <div class="bg-white p-4 rounded-xl shadow-sm border border-border-color">
                <div id="scatterPlot" class="w-full h-[500px]"></div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                <div class="bg-white p-5 rounded-lg border border-border-color">
                    <div class="text-lg font-bold text-primary mb-2">🏆 传统龙头</div>
                    <p class="text-sm text-text-sub">比亚迪凭借全产业链垂直整合能力，在10-20万区间拥有绝对定价权，销量规模最大。</p>
                </div>
                <div class="bg-white p-5 rounded-lg border border-border-color">
                    <div class="text-lg font-bold text-primary mb-2">🦈 鲶鱼效应</div>
                    <p class="text-sm text-text-sub">特斯拉依然保持高毛利，通过不断降价挤压竞争对手，主要占据25-30万区间。</p>
                </div>
                <div class="bg-white p-5 rounded-lg border border-border-color">
                    <div class="text-lg font-bold text-primary mb-2">🚀 新势力</div>
                    <p class="text-sm text-text-sub">理想、蔚来、小鹏各有侧重（增程、换电、智驾），主攻30万以上高端市场及细分需求。</p>
                </div>
            </div>
        </section>

        <!-- SECTION 5: Summary & Outlook -->
        <section class="bg-white rounded-xl shadow-sm border border-border-color p-8 mt-12">
            <h2 class="text-2xl font-bold text-text-main mb-6">未来展望：2025-2030</h2>
            <div class="space-y-6">
                <div class="flex items-start">
                    <div class="flex-shrink-0 w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold mr-4">1</div>
                    <div>
                        <h4 class="text-lg font-bold text-text-main">智能化下半场</h4>
                        <p class="text-text-sub mt-1">电动化只是序幕，智能化（自动驾驶、智能座舱）将成为车企差异化竞争的核心。城市NOA功能将加速落地。</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="flex-shrink-0 w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold mr-4">2</div>
                    <div>
                        <h4 class="text-lg font-bold text-text-main">出海战略加速</h4>
                        <p class="text-text-sub mt-1">中国车企将从单纯的产品出口转向在海外建厂、建立销售网络，深度参与全球竞争，尤其在欧洲和东南亚市场。</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="flex-shrink-0 w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold mr-4">3</div>
                    <div>
                        <h4 class="text-lg font-bold text-text-main">补能体系完善</h4>
                        <p class="text-text-sub mt-1">800V高压快充平台将下沉至15万级车型，充电5分钟续航200公里将成为常态，彻底缓解里程焦虑。</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t border-border-color mt-16 py-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-text-sub text-sm">© 2024 新能源汽车行业深度分析报告 | 交互式数据展示</p>
            <p class="text-xs text-gray-400 mt-2">数据来源：中汽协、乘联会、各大车企财报及公开研报整理。</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- 1. State Management ---
        const state = {
            chartTimeframe: 'history', // 'history' or 'forecast'
            activeTab: 'battery'
        };

        // --- 2. Data Store ---
        const marketData = {
            history: {
                labels: ['2019', '2020', '2021', '2022', '2023'],
                sales: [120.6, 136.7, 352.1, 688.7, 949.5], // China NEV Sales (10k units)
                penetration: [4.7, 5.4, 13.4, 25.6, 31.6] // Percentage
            },
            forecast: {
                labels: ['2023', '2024E', '2025E', '2026E'],
                sales: [949.5, 1150.0, 1380.0, 1600.0],
                penetration: [31.6, 39.0, 48.0, 55.0]
            }
        };

        const carModels = [
            { name: '比亚迪 海鸥', price: 7.38, range: 305, brand: 'BYD', type: 'Entry' },
            { name: '五菱 缤果', price: 5.98, range: 203, brand: 'Wuling', type: 'Entry' },
            { name: '比亚迪 秦PLUS', price: 9.98, range: 420, brand: 'BYD', type: 'Compact' },
            { name: '埃安 Y', price: 11.98, range: 430, brand: 'GAC', type: 'Compact' },
            { name: '大众 ID.3', price: 12.59, range: 450, brand: 'VW', type: 'Compact' },
            { name: '比亚迪 宋PLUS', price: 15.98, range: 520, brand: 'BYD', type: 'SUV' },
            { name: '小鹏 G6', price: 20.99, range: 580, brand: 'Xpeng', type: 'SUV' },
            { name: '特斯拉 Model 3', price: 24.59, range: 606, brand: 'Tesla', type: 'Sedan' },
            { name: '特斯拉 Model Y', price: 25.89, range: 554, brand: 'Tesla', type: 'SUV' },
            { name: '极氪 001', price: 26.90, range: 750, brand: 'Zeekr', type: 'Sedan' },
            { name: '蔚来 ET5', price: 29.80, range: 560, brand: 'Nio', type: 'Sedan' },
            { name: '理想 L7', price: 31.98, range: 1100, brand: 'Li', type: 'SUV' }, // EREV range usually higher
            { name: '蔚来 ES6', price: 33.80, range: 490, brand: 'Nio', type: 'SUV' },
            { name: '问界 M7', price: 24.98, range: 1050, brand: 'AITO', type: 'SUV' }
        ];

        // --- 3. Chart Initialization & Updates ---
        let marketChartInstance = null;

        function initMarketChart() {
            const ctx = document.getElementById('marketChart').getContext('2d');
            
            marketChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: marketData.history.labels,
                    datasets: [
                        {
                            label: '销量 (万辆)',
                            data: marketData.history.sales,
                            backgroundColor: 'rgba(15, 118, 110, 0.7)', // Teal
                            borderColor: 'rgba(15, 118, 110, 1)',
                            borderWidth: 1,
                            yAxisID: 'y',
                            borderRadius: 4
                        },
                        {
                            label: '渗透率 (%)',
                            data: marketData.history.penetration,
                            type: 'line',
                            borderColor: '#F97316', // Orange
                            backgroundColor: '#F97316',
                            borderWidth: 3,
                            pointRadius: 4,
                            pointBackgroundColor: '#FFFFFF',
                            pointBorderWidth: 2,
                            yAxisID: 'y1',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#1C1917',
                            bodyColor: '#57534E',
                            borderColor: '#E7E5E4',
                            borderWidth: 1,
                            padding: 10
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: '销量 (万辆)' },
                            grid: { display: false }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: '渗透率 (%)' },
                            grid: { borderDash: [2, 4] }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function updateMarketChart(timeframe) {
            state.chartTimeframe = timeframe;
            const data = marketData[timeframe];
            
            // Update UI buttons
            document.getElementById('btn-history').classList.toggle('bg-primary', timeframe === 'history');
            document.getElementById('btn-history').classList.toggle('text-white', timeframe === 'history');
            document.getElementById('btn-history').classList.toggle('text-text-sub', timeframe !== 'history');
            
            document.getElementById('btn-forecast').classList.toggle('bg-primary', timeframe === 'forecast');
            document.getElementById('btn-forecast').classList.toggle('text-white', timeframe === 'forecast');
            document.getElementById('btn-forecast').classList.toggle('text-text-sub', timeframe !== 'forecast');

            // Update Chart Data
            marketChartInstance.data.labels = data.labels;
            marketChartInstance.data.datasets[0].data = data.sales;
            marketChartInstance.data.datasets[1].data = data.penetration;
            marketChartInstance.update();
        }

        function initScatterPlot() {
            // Transform data for Plotly
            const trace = {
                x: carModels.map(c => c.price),
                y: carModels.map(c => c.range),
                mode: 'markers',
                type: 'scatter',
                text: carModels.map(c => `<b>${c.name}</b><br>品牌: ${c.brand}<br>价格: ${c.price}万<br>续航: ${c.range}km`),
                marker: {
                    size: 14,
                    color: carModels.map(c => {
                        if (c.brand === 'BYD') return '#0F766E'; // Teal
                        if (c.brand === 'Tesla') return '#F97316'; // Orange
                        return '#A8A29E'; // Gray for others
                    }),
                    opacity: 0.8,
                    line: {
                        color: 'white',
                        width: 1
                    }
                },
                hovertemplate: '%{text}<extra></extra>'
            };

            const layout = {
                title: {
                    text: '主流车型：价格 vs 续航分布',
                    font: { size: 16, color: '#1C1917' }
                },
                xaxis: {
                    title: '起售价 (万元)',
                    gridcolor: '#F5F5F4',
                    zeroline: false
                },
                yaxis: {
                    title: 'CLTC 续航里程 (km)',
                    gridcolor: '#F5F5F4',
                    zeroline: false
                },
                hovermode: 'closest',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                margin: { t: 40, r: 20, b: 40, l: 50 },
                showlegend: false
            };

            const config = { responsive: true, displayModeBar: false };

            Plotly.newPlot('scatterPlot', [trace], layout, config);
        }

        // --- 4. Tab Interaction ---
        function switchTechTab(tabId) {
            // Update active state logic
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(`tech-${tabId}`).classList.add('active');

            // Update button styles
            document.querySelectorAll('.tech-tab').forEach(btn => {
                btn.classList.remove('active', 'border-primary', 'bg-warm-bg');
                btn.classList.add('border-border-color', 'bg-white');
            });
            
            // Highlight clicked button (need to find the specific button logic, simplified here by recreating listener or just rely on class toggling manually if not strictly bound)
            // Ideally, we pass 'this' or select by index. For now, simple class reset is fine.
            // Let's re-select based on onclick attribute for simplicity in this vanilla implementation
            const activeBtn = document.querySelector(`button[onclick="switchTechTab('${tabId}')"]`);
            if(activeBtn) {
                activeBtn.classList.remove('border-border-color', 'bg-white');
                activeBtn.classList.add('border-primary', 'bg-warm-bg', 'active'); // bg-warm-bg simulates selected state
            }
        }

        // --- 5. Counter Animation ---
        function startCounters() {
            const counters = document.querySelectorAll('.counter');
            counters.forEach(counter => {
                const target = +counter.getAttribute('data-target');
                const duration = 2000; // ms
                const increment = target / (duration / 16); // 60fps
                
                let current = 0;
                const updateCounter = () => {
                    current += increment;
                    if (current < target) {
                        counter.innerText = Math.ceil(current);
                        requestAnimationFrame(updateCounter);
                    } else {
                        counter.innerText = target;
                    }
                };
                updateCounter();
            });
        }

        // --- 6. Mobile Menu ---
        document.getElementById('mobile-menu-btn').addEventListener('click', () => {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        });

        // --- 7. Init ---
        window.addEventListener('DOMContentLoaded', () => {
            initMarketChart();
            initScatterPlot();
            startCounters();
            
            // Highlight initial tab
            switchTechTab('battery');
        });

        // Handle resize for Plotly
        window.addEventListener('resize', () => {
            Plotly.Plots.resize('scatterPlot');
        });

    </script>
</body>
</html>